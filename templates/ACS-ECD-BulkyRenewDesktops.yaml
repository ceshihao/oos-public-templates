FormatVersion: OOS-2019-06-01
Description:
  en: Bulky renew subscription cloud desktops
  zh-cn: 批量续费包年包月云桌面
  name-en: ACS-ECD-BulkyRenewDesktops
  name-zh-cn: 批量续费包年包月云桌面
Parameters:
  regionId:
    Type: String
    Description:
      en: The id of region
      zh-cn: 地域ID
    AssociationProperty: RegionId
    Default: '{{ ACS::RegionId }}'
  desktopIds:
    Description:
      en: The id of desktop
      zh-cn: 云桌面ID
    Type: List
    Default: [ ]
  periodUnit:
    Description:
      en: The unit of the renewal duration specified by the Period parameter.
      zh-cn: 续费时长的单位，即参数Period的单位
    Type: String
    AllowedValues:
      - Year
      - Month
    Default: Month
  period:
    Description:
      en: >-
        The renewal duration. The valid values of this parameter are determined by the PeriodUnit value.
        If PeriodUnit is set to Month, the valid values of the Period parameter are 1, 2, 3, and 6.
        If PeriodUnit is set to Year, the valid values of the Period parameter are 1, 2, 3, 4, and 5.
      zh-cn: >-
        续费时长。取值范围由参数PeriodUnit的值决定。
        PeriodUnit为Month时，取值范围为：1、2、3、6。
        PeriodUnit为Year时，取值范围为：1~5。
    Type: Number
    Default: 1
    MinValue: 1
    MaxValue: 6
  autoPay:
    Description:
      en: >-
        Specifies whether to enable automatic payment. Valid values:
        true: enables automatic payment. Make sure that you have sufficient balance in your account. Otherwise, abnormal orders are generated.
        false: generates the order with no payment made. You can log on to the EDS console and complete the payment based on the order number.
      zh-cn: >-
        是否自动支付。取值范围：
        true：自动支付。请确保账户余额充足，否则会产生异常订单。
        false：只产生订单，不支付。您可以根据返回的订单号登录控制台进行支付。
    Type: Boolean
  rateControl:
    Description:
      en: Concurrency ratio of task execution.
      zh-cn: 任务执行的并发比率。
    Type: Json
    AssociationProperty: RateControl
    Default:
      Mode: Concurrency
      MaxErrors: 0
      Concurrency: 10
  OOSAssumeRole:
    Description:
      en: The RAM role to be assumed by OOS.
      zh-cn: OOS扮演的RAM角色。
    Type: String
    Default: OOSServiceRole
RamRole: '{{ OOSAssumeRole }}'
Tasks:
  - Name: renewDesktop
    Action: 'ACS::ExecuteAPI'
    Description:
      en: Renew desktops
      zh-cn: 续费云桌面
    Properties:
      Service: ECD
      API: RenewDesktops
      Parameters:
        RegionId: '{{ regionId }}'
        DesktopId:
          - '{{ ACS::TaskLoopItem }}'
        Period: '{{ period }}'
        PeriodUnit: '{{ periodUnit }}'
        AutoPay: '{{ autoPay }}'
    Loop:
      RateControl: '{{ rateControl }}'
      Items: '{{ desktopIds }}'
