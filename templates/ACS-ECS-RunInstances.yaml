FormatVersion: OOS-2019-06-01
Description:
  en: Creates one or more ECS instances
  zh-cn: 创建ECS实例
  name-en: ACS-ECS-RunInstances
  name-zh-cn: 创建ECS实例
  categories:
    - cost_manage
Parameters:
  regionId:
    Label:
      en: RegionId
      zh-cn: 地域ID
    Type: String
    AssociationProperty: ALIYUN::ECS::RegionId
    Default: '{{ ACS::RegionId }}'
  imageId:
    Label:
      en: ImageId
      zh-cn: 镜像ID
    Type: String
    AssociationProperty: 'ALIYUN::ECS::Image::ImageId'
  instanceType:
    Label:
      en: InstanceType
      zh-cn: 实例类型
    Type: String
    AssociationProperty: 'ALIYUN::ECS::Instance::InstanceType'
    AllowedPattern: ecs\.[A-Za-z0-9\.\-]*
  securityGroupId:
    Label:
      en: SecurityGroupId
      zh-cn: 安全组ID
    Type: String
    AssociationProperty: 'ALIYUN::ECS::SecurityGroup::SecurityGroupId'
  vSwitchId:
    Label:
      en: VSwitchId
      zh-cn: 交换机ID
    Type: String
    AssociationProperty: 'ALIYUN::VPC::VSwitch::VSwitchId'
    AssociationPropertyMetadata:
      Filters:
        - SecurityGroupId: securityGroupId
  internetMaxBandwidthOut:
    Label:
      en: InternetMaxBandwidthOut
      zh-cn: 公网带宽
    Description:
      zh-cn: 公网出带宽最大值，单位为 Mbit/s。取值范围：0~100。
      en: 'The maximum outbound bandwidth of the instance. Unit: Mbit/s. Valid values: 0 to 100.'
    Type: Number
    Default: 0
  amount:
    Label:
      en: Amount
      zh-cn: 实例数量
    Type: Number
    Default: 1
  instanceName:
    Label:
      en: InstanceName
      zh-cn: 实例名称
    Type: String
    Default: ''
  systemDiskCategory:
    Label:
      en: SystemDiskCategory
      zh-cn: 系统盘的云盘种类
    Type: String
    AssociationProperty: ALIYUN::ECS::Disk::SystemDiskCategory
    AssociationPropertyMetadata:
      RegionId: regionId
      InstanceType: instanceType
      InstanceChargeType: instanceChargeType
    AllowedValues:
      - cloud_efficiency
      - cloud_ssd
      - cloud_essd
      - cloud_auto
      - cloud
      - cloud_essd_entry
    Default: cloud_essd
  systemDiskSize:
    Label:
      en: SystemDiskSize
      zh-cn: 系统盘大小
    Type: String
    Default: ''
  systemDiskName:
    Label:
      en: systemDiskName
      zh-cn: 系统盘名称
    Type: String
    Default: ''
  systemDiskDescription:
    Label:
      en: systemDiskDescription
      zh-cn: 系统盘描述
    Type: String
    Default: ''
  systemDiskPerformanceLevel:
    Label:
      en: systemDiskPerformanceLevel
      zh-cn: 系统盘云盘的性能等级
    Type: String
    AllowedValues:
      - PL0
      - PL1
      - PL2
      - PL3
    Default: PL1
  privateIpAddress:
    Type: String
    Label:
      zh-cn: 实例私网IP地址
      en: Private IP Address
    Description:
      zh-cn: '实例私网 IP 地址。专有网络 VPC 类型 ECS 实例设置私网 IP 地址时，必须从虚拟交换机（VSwitchId）的空闲网段中选择。'
      en: 'Private IP address of an instance. When setting a private IP address for an ECS instance of the Virtual Private Cloud (VPC) type, it must be selected from the available subnet of the virtual switch (VSwitchId).'
    Default: ''
  systemDiskAutoSnapshotPolicyId:
    Label:
      en: SystemDiskAutoSnapshotPolicyId
      zh-cn: 系统盘采用的自动快照策略ID
    Type: String
    Default: ''
  OOSAssumeRole:
    Label:
      en: OOSAssumeRole
      zh-cn: OOS扮演的RAM角色
    Type: String
    Default: ''
RamRole: '{{ OOSAssumeRole }}'
Tasks:
- Name: runInstances
  Action: ACS::ECS::RunInstances
  Description:
    en: Creates one or more ECS instances
    zh-cn: 创建实例
  Properties:
    regionId: '{{ regionId }}'
    imageId: '{{ imageId }}'
    instanceType: '{{ instanceType }}'
    securityGroupId: '{{ securityGroupId }}'
    vSwitchId: '{{ vSwitchId }}'
    internetMaxBandwidthOut: '{{ internetMaxBandwidthOut }}'
    amount: '{{ amount }}'
    instanceName: '{{ instanceName }}'
    systemDiskSize: '{{ systemDiskSize }}'
    systemDiskCategory: '{{ systemDiskCategory }}'
    systemDiskName: '{{ systemDiskName }}'
    systemDiskDescription: '{{ systemDiskDescription }}'
    systemDiskPerformanceLevel: '{{ systemDiskPerformanceLevel }}'
    systemDiskAutoSnapshotPolicyId: '{{ systemDiskAutoSnapshotPolicyId }}'
    privateIpAddress: '{{ privateIpAddress }}'
  Outputs:
    instanceId:
      ValueSelector: instanceIds
      Type: List
Outputs:
  instanceId:
    Type: String
    Value: '{{ runInstances.instanceId }}'
Metadata:
  ALIYUN::OOS::Interface:
    ParameterGroups:
      - Parameters:
          - accessToken
        Label:
          default:
            zh-cn: 钉钉访问令牌
            en: Dingtalk Access Token
      - Parameters:
          - imageId
          - instanceType
          - securityGroupId
          - vSwitchId
          - amount
          - SystemDiskDiskName
          - systemDiskCategory
          - systemDiskSize
          - SystemDiskDescription
          - SystemDiskPerformanceLevel
          - SystemDiskAutoSnapshotPolicyId
          - PrivateIpAddress
        Label:
          default:
            zh-cn: 创建实例选型
            en: Run Command Options
      - Parameters:
          - OOSAssumeRole
        Label:
          default:
            zh-cn: 高级选项
            en: Control Options
