FormatVersion: OOS-2019-06-01
Description:
  en: Creates one or more ECS instances
  zh-cn: 创建ECS实例
  name-en: ACS-ECS-RunInstances
  name-zh-cn: 创建ECS实例
  categories:
    - cost_manage
Parameters:
  regionId:
    Label:
      en: RegionId
      zh-cn: 地域ID
    Type: String
    AssociationProperty: ALIYUN::ECS::RegionId
    Default: '{{ ACS::RegionId }}'
  zoneId:
    Type: String
    Label:
      en: instance zone
      zh-cn: 实例所属的可用区ID
    AssociationProperty: ALIYUN::ECS::ZoneId
    AssociationPropertyMetadata:
      RegionId: regionId
    Default: ''
  hostName:
    Type: String
    Label:
      en: instance host name
      zh-cn: 主机名称
    Default: ''
  imageId:
    Label:
      en: ImageId
      zh-cn: 镜像ID
    Type: String
    AssociationProperty: 'ALIYUN::ECS::Image::ImageId'
  instanceType:
    Label:
      en: InstanceType
      zh-cn: 实例类型
    Type: String
    AssociationProperty: 'ALIYUN::ECS::Instance::InstanceType'
    AllowedPattern: ecs\.[A-Za-z0-9\.\-]*
  securityGroupId:
    Label:
      en: SecurityGroupId
      zh-cn: 安全组ID
    Type: String
    AssociationProperty: 'ALIYUN::ECS::SecurityGroup::SecurityGroupId'
  vSwitchId:
    Label:
      en: VSwitchId
      zh-cn: 交换机ID
    Type: String
    AssociationProperty: 'ALIYUN::VPC::VSwitch::VSwitchId'
    AssociationPropertyMetadata:
      Filters:
        - SecurityGroupId: securityGroupId
  internetMaxBandwidthOut:
    Label:
      en: InternetMaxBandwidthOut
      zh-cn: 公网带宽
    Description:
      zh-cn: 公网出带宽最大值，单位为 Mbit/s。取值范围：0~100。
      en: 'The maximum outbound bandwidth of the instance. Unit: Mbit/s. Valid values: 0 to 100.'
    Type: Number
    Default: 0
  amount:
    Label:
      en: Amount
      zh-cn: 实例数量
    Type: Number
    Default: 1
  instanceName:
    Label:
      en: InstanceName
      zh-cn: 实例名称
    Type: String
    Default: ''
  systemDiskCategory:
    Label:
      en: SystemDiskCategory
      zh-cn: 系统盘的云盘种类
    Type: String
    AssociationProperty: ALIYUN::ECS::Disk::SystemDiskCategory
    AssociationPropertyMetadata:
      RegionId: regionId
      InstanceType: instanceType
      InstanceChargeType: instanceChargeType
    AllowedValues:
      - cloud_efficiency
      - cloud_ssd
      - cloud_essd
      - cloud_auto
      - cloud
      - cloud_essd_entry
    Default: cloud_essd
  systemDiskSize:
    Label:
      en: SystemDiskSize
      zh-cn: 系统盘大小
    Type: String
    Default: ''
  systemDiskName:
    Label:
      en: systemDiskName
      zh-cn: 系统盘名称
    Type: String
    Default: ''
  systemDiskDescription:
    Label:
      en: systemDiskDescription
      zh-cn: 系统盘描述
    Type: String
    Default: ''
  systemDiskPerformanceLevel:
    Label:
      en: systemDiskPerformanceLevel
      zh-cn: 系统盘云盘的性能等级
    Type: String
    AllowedValues:
      - PL0
      - PL1
      - PL2
      - PL3
    Default: PL1
  privateIpAddress:
    Type: String
    Label:
      zh-cn: 实例私网IP地址
      en: Private IP Address
    Description:
      zh-cn: '实例私网 IP 地址。专有网络 VPC 类型 ECS 实例设置私网 IP 地址时，必须从虚拟交换机（VSwitchId）的空闲网段中选择。'
      en: 'Private IP address of an instance. When setting a private IP address for an ECS instance of the Virtual Private Cloud (VPC) type, it must be selected from the available subnet of the virtual switch (VSwitchId).'
    Default: ''
  systemDiskAutoSnapshotPolicyId:
    Label:
      en: SystemDiskAutoSnapshotPolicyId
      zh-cn: 系统盘采用的自动快照策略ID
    Type: String
    Default: ''
  dataDiskParameters:
    Type: List
    Default: []
    Label:
      en: DataDisk Configure
      zh-cn: 数据盘配置
    AssociationProperty: List[Parameter]
    AssociationPropertyMetadata:
      Parameter:
        Type: Json
        AssociationPropertyMetadata:
          Parameters:
            Size:
              Label:
                en: Size
                zh-cn: 数据盘大小
              Type: String
              Default: ''
            DiskName:
              Label:
                en: DiskName
                zh-cn: 数据盘名称
              Type: String
              Default: ''
            Description:
              Label:
                en: Description
                zh-cn: 数据盘描述
              Type: String
              Default: ''
            Category:
              Label:
                en: Category
                zh-cn: 数据盘云盘种类
              Type: String
              AllowedValues:
                - cloud_efficiency
                - cloud_ssd
                - cloud_essd
                - cloud_auto
                - cloud
                - cloud_essd_entry
                - cloud_regional_disk_auto
                - elastic_ephemeral_disk_standard
                - elastic_ephemeral_disk_premium
              Default: cloud_essd
            PerformanceLevel:
              Label: 云盘的性能等级
              Type: String
              AllowedValues:
                - PL0
                - PL1
                - PL2
                - PL3
              Default: PL1
            AutoSnapshotPolicyId:
              Label: 自动快照策略ID
              Type: String
              Default: ''
  tags:
    Label:
      en: Tags
      zh-cn: 标签
    Description:
      en: 'The tags of new ECS instance to add on, e.g.[{"Key":"oos","Value":"test"}]'
      zh-cn: ECS实例的标签，例如：[{"Key":"oos","Value":"test"}]
    Type: Json
    AssociationProperty: Tags
    AssociationPropertyMetadata:
      ShowSystem: false
    Default: []
  resourceGroupId:
    Label:
      en: ResourceGroupId
      zh-cn: 资源组ID
    Type: String
    AssociationProperty: ALIYUN::ECS::ResourceGroup::ResourceGroupId
    Default: ''
  description:
    Label:
      en: Description
      zh-cn: 实例描述
    Type: String
    Default: ''
  OOSAssumeRole:
    Label:
      en: OOSAssumeRole
      zh-cn: OOS扮演的RAM角色
    Type: String
    Default: ''
RamRole: '{{ OOSAssumeRole }}'
Tasks:
- Name: runInstances
  Action: ACS::ECS::RunInstances
  Description:
    en: Creates one or more ECS instances
    zh-cn: 创建实例
  Properties:
    regionId: '{{ regionId }}'
    zoneId: '{{ zoneId }}'
    hostName: '{{ hostName }}'
    imageId: '{{ imageId }}'
    instanceType: '{{ instanceType }}'
    securityGroupId: '{{ securityGroupId }}'
    vSwitchId: '{{ vSwitchId }}'
    internetMaxBandwidthOut: '{{ internetMaxBandwidthOut }}'
    amount: '{{ amount }}'
    instanceName: '{{ instanceName }}'
    systemDiskSize: '{{ systemDiskSize }}'
    systemDiskCategory: '{{ systemDiskCategory }}'
    systemDiskName: '{{ systemDiskName }}'
    systemDiskDescription: '{{ systemDiskDescription }}'
    systemDiskPerformanceLevel: '{{ systemDiskPerformanceLevel }}'
    systemDiskAutoSnapshotPolicyId: '{{ systemDiskAutoSnapshotPolicyId }}'
    privateIpAddress: '{{ privateIpAddress }}'
    dataDiskParameters: '{{ dataDiskParameters }}'
    tags: '{{ tags }}'
    resourceGroupId: '{{ resourceGroupId }}'
    description: '{{ description }}'
  Outputs:
    instanceId:
      ValueSelector: instanceIds
      Type: List
Outputs:
  instanceId:
    Type: String
    Value: '{{ runInstances.instanceId }}'
Metadata:
  ALIYUN::OOS::Interface:
    ParameterGroups:
      - Parameters:
          - regionId
        Label:
          default:
            en: Select Region
            zh-cn: 选择地域
      - Parameters:
          - vSwitchId
          - zoneId
          - securityGroupId
          - imageId
          - instanceType
          - instanceName
          - hostName
          - description
          - tags
          - resourceGroupId
        Label:
          default:
            zh-cn: 创建实例选型
            en: Run Command Options
      - Parameters:
          - systemDiskName
          - systemDiskCategory
          - systemDiskSize
          - systemDiskDescription
          - systemDiskPerformanceLevel
          - systemDiskAutoSnapshotPolicyId
          - dataDiskParameters
        Label:
          default:
            zh-cn: 块存储配置
            en: SystemDiskDisk Configure
      - Parameters:
          - internetMaxBandwidthOut
          - privateIpAddress
        Label:
          default:
            zh-cn: 网络配置
            en: internet Configure
      - Parameters:
          - amount
        Label:
          default:
            en: Instance Count
            zh-cn: 实例数量
      - Parameters:
          - OOSAssumeRole
        Label:
          default:
            zh-cn: 高级选项
            en: Control Options
