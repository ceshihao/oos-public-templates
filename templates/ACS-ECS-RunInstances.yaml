FormatVersion: OOS-2019-06-01
Description:
  en: Creates one or more ECS instances
  zh-cn: 创建ECS实例
  name-en: ACS-ECS-RunInstances
  name-zh-cn: 创建ECS实例
  categories:
    - cost_manage
Parameters:
  regionId:
    Label:
      en: RegionId
      zh-cn: 地域ID
    Type: String
    AssociationProperty: ALIYUN::ECS::RegionId
    Default: '{{ ACS::RegionId }}'
  imageId:
    Label:
      en: ImageId
      zh-cn: 镜像ID
    Type: String
    AssociationProperty: 'ALIYUN::ECS::Image::ImageId'
  instanceType:
    Label:
      en: InstanceType
      zh-cn: 实例类型
    Type: String
    AssociationProperty: 'ALIYUN::ECS::Instance::InstanceType'
    AllowedPattern: ecs\.[A-Za-z0-9\.\-]*
  securityGroupId:
    Label:
      en: SecurityGroupId
      zh-cn: 安全组ID
    Type: String
    AssociationProperty: 'ALIYUN::ECS::SecurityGroup::SecurityGroupId'
  vSwitchId:
    Label:
      en: VSwitchId
      zh-cn: 交换机ID
    Type: String
    AssociationProperty: 'ALIYUN::VPC::VSwitch::VSwitchId'
    AssociationPropertyMetadata:
      Filters:
        - SecurityGroupId: securityGroupId
  internetMaxBandwidthOut:
    Label:
      en: InternetMaxBandwidthOut
      zh-cn: 公网带宽
    Description:
      zh-cn: 公网出带宽最大值，单位为 Mbit/s。取值范围：0~100。
      en: 'The maximum outbound bandwidth of the instance. Unit: Mbit/s. Valid values: 0 to 100.'
    Type: Number
    Default: 0
  amount:
    Label:
      en: Amount
      zh-cn: 实例数量
    Type: Number
    Default: 1
  instanceName:
    Label:
      en: InstanceName
      zh-cn: 实例名称
    Type: String
    Default: ''
  OOSAssumeRole:
    Label:
      en: OOSAssumeRole
      zh-cn: OOS扮演的RAM角色
    Type: String
    Default: ''
RamRole: '{{ OOSAssumeRole }}'
Tasks:
- Name: runInstances
  Action: ACS::ECS::RunInstances
  Description:
    en: Creates one or more ECS instances
    zh-cn: 创建实例
  Properties:
    regionId: '{{ regionId }}'
    imageId: '{{ imageId }}'
    instanceType: '{{ instanceType }}'
    securityGroupId: '{{ securityGroupId }}'
    vSwitchId: '{{ vSwitchId }}'
    internetMaxBandwidthOut: '{{ internetMaxBandwidthOut }}'
    amount: '{{ amount }}'
    instanceName: '{{ instanceName }}'
  Outputs:
    instanceId:
      ValueSelector: instanceIds
      Type: List
Outputs:
  instanceId:
    Type: String
    Value: '{{ runInstances.instanceId }}'
Metadata:
  ALIYUN::OOS::Interface:
    ParameterGroups:
      - Parameters:
          - accessToken
        Label:
          default:
            zh-cn: 钉钉访问令牌
            en: Dingtalk Access Token
      - Parameters:
          - imageId
          - instanceType
          - securityGroupId
          - vSwitchId
          - amount
        Label:
          default:
            zh-cn: 创建实例选型
            en: Run Command Options
      - Parameters:
          - OOSAssumeRole
        Label:
          default:
            zh-cn: 高级选项
            en: Control Options
