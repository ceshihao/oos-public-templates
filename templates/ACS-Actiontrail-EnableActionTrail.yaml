FormatVersion: OOS-2019-06-01
Description:
  en: Enable action trail.
  zh-cn: 开启跟踪。
  name-en: ACS-Actiontrail-EnableActionTrail
  name-zh-cn: 开启操作审计跟踪
  categories:
    - security
Parameters:
  regionId:
    Type: String
    Description:
      name-en: The id of region.
      name-zh-cn: 地域ID。
    AssociationProperty: RegionId
    Default: '{{ ACS::RegionId }}'
  trailName:
    Description:
      name-en: The name for trail.
      name-zh-cn: 创建的跟踪名称。
    Type: String
  ossBucketName:
    Description:
      name-en: The OOS Bucket name for creating trail.
      name-zh-cn: 跟踪写入的 OSS bucket 名称。
    Type: String
    Default: ''
  roleName:
    Description:
      name-en: The name of the ram role that the user allows the actiontrail service to play.
      name-zh-cn: 用户允许 ActionTrail服务扮演的RAM角色名称。
    Type: String
    Default: aliyunactiontraildefaultrole
  eventRW:
    Description:
      name-en: Read and write type of delivery event.
      name-zh-cn: 投递事件的读写类型。
    Type: String
    Default: All
    AllowedValues:
      - All
      - Write
      - Read
  trailRegion:
    Description:
      name-en: The trail region(for example:All、cn-hangzhou).
      name-zh-cn: 跟踪的地域(例如：All、cn-hangzhou)。
    Type: String
    Default: All
  OOSAssumeRole:
    Description:
      name-en: The RAM role to be assumed by OOS.
      name-zh-cn: OOS扮演的RAM角色。
    Type: String
    Default: OOSServiceRole
RamRole: '{{ OOSAssumeRole }}'
Tasks:
  - Name: createTrail
    Action: 'ACS::ExecuteAPI'
    Description:
      name-en: Create trail.
      name-zh-cn: 创建跟踪。
    Properties:
      Service: Actiontrail
      API: CreateTrail
      Parameters:
        RegionId: '{{ regionId }}'
        Name: '{{ trailName }}'
        OssBucketName: '{{ ossBucketName }}'
        RoleName: '{{ roleName }}'
        EventRW: '{{ eventRW }}'
        TrailRegion: '{{ trailRegion }}'
    Outputs:
      trail:
        Type: Json
        ValueSelector: .
Outputs:
  trails:
    Type: Json
    Value: '{{ createTrail.trail }}'

