FormatVersion: OOS-2019-06-01
Description:
  en: Set logstore for Edas apps in bulk
  zh-cn: 批量配置EDAS应用的日志服务
  name-en: ACS-EDAS-BulkyUpdateSlsLogStore
  name-zh-cn: 批量配置EDAS应用的日志服务
  categories:
    - security
    - edas
Parameters:
  regionId:
    Label:
      en: RegionId
      zh-cn: 地域ID
    Type: String
    AssociationProperty: RegionId
    Default: '{{ ACS::RegionId }}'
  appIds:
    Label:
      en: AppIds
      zh-cn: 应用Id列表
    Type: List
  configs:
    Label:
      en: Configs
      zh-cn: Logstore配置
    Description:
      en: type, collection type, file type is file, standard output type is stdout. Logstore, Logstore name, ensure uniqueness within the same cluster, automatically generated by system if empty.LogDir, collection path, stdout.log for standard output type, file path for file type, supports wildcards.
      zh-cn: type，采集类型，文件类型为 file，标准输出类型为 stdout。Logstore，Logstore 名称。请确保 Logstore 名称在同一个集群中不重复，若为空，则由系统自动生成。LogDir，若为标准输出类型，则采集路径为 stdout.log，若为文件类型，则为采集的文件路径，支持通配符。
    Type: String
    Default: '[{"logstore":"","type":"stdout","logDir":"stdout.log"}]'
  rateControl:
    Label:
      en: RateControl
      zh-cn: 任务执行的并发比率
    Type: Json
    AssociationProperty: RateControl
    Default:
      Mode: Concurrency
      MaxErrors: 0
      Concurrency: 10
  OOSAssumeRole:
    Label:
      en: OOSAssumeRole
      zh-cn: OOS扮演的RAM角色
    Type: String
    Default: ''
RamRole: '{{ OOSAssumeRole }}'
Tasks:
  - Name: updateSlsLogStore
    Action: ACS::ExecuteAPI
    Description:
      en: Set logstore for Edas app
      zh-cn: 配置EDAS应用的日志服务
    Properties:
      Service: edas
      API: UpdateSlsLogStore
      Parameters:
        RegionId: '{{ regionId }}'
        AppId: '{{ ACS::TaskLoopItem }}'
        Configs: '{{ configs }}'
    Outputs: {}
    Loop:
      Items: '{{ appIds }}'
      RateControl: '{{ rateControl }}'
      Outputs: {}
